
# Config Language Tool — CLI

Этот репозиторий содержит реализацию CLI-инструмента для учебного конфигурационного языка.  
Инструмент преобразует текстовую конфигурацию в **IR (промежуточное представление)** и сохраняет в **YAML**, поддерживая глобальные константы и постфиксные вычисления (RPN).

---

## Содержимое

* `config_tool.py` — основной скрипт CLI. Реализует парсер, трансформацию в IR и сохранение в YAML.
* `examples/` — директория с тестовыми конфигурациями:
  - `webserver.cfg`
  - `database.cfg`
  - `experiment.cfg`

---

## Язык конфигурации (кратко)

**Глобальные константы**:  
  ```text
  global NAME = VALUE
````

Значение может быть числом, строкой, списком или словарём.

* **Словари**:

  ```text
  ([ key1: value1, key2: value2 ])
  ```

* **Списки**:

  ```text
  [ value1, value2, value3 ]
  ```

* **Строки**: одинарные кавычки `'строка'`

* **Постфиксные константные выражения (RPN)**:

  ```text
  .( TOKEN1 TOKEN2 OP ).
  ```

  Поддерживаемые операции: `+`, `-`, `*`, `/`, `mod`

* **Многострочные комментарии**:

  ```text
  =begin
  Многострочный
  комментарий
  =end
  ```

---

## CLI

### Команда `assemble`

Собирает конфигурацию в IR и сохраняет в YAML:

```bash
python config_tool.py assemble <infile> <outfile> [--test]
```

Аргументы:

* `<infile>` — путь к исходной конфигурации (`.cfg`)
* `<outfile>` — путь к YAML-файлу с IR
* `--test` — выводит глобальные константы и IR на экран

Пример:

```bash
python config_tool.py assemble examples/webserver.cfg out.yml --test
```

Вывод в тестовом режиме:

```
Globals:
  MAX_CONN = 100
  PORT = 8080
Statements:
[{'server_name': 'main', 'max_connections': 100, 'listen_port': 8080}]
Wrote IR to out.yml
```

---

## Примеры конфигураций

1. **Webserver** — `examples/webserver.cfg`
2. **Database** — `examples/database.cfg`
3. **Experiment** — `examples/experiment.cfg`

Все примеры содержат глобальные константы, словари, списки и RPN-выражения.

---

## Установка зависимостей

```bash
pip install lark pyyaml
```

---

## Тестирование

Используется `pytest`. Проверяет корректность сборки IR для всех примеров:

```bash
pytest -q
```

---

## Особенности

* Обработка глобальных констант
* Вычисления константных выражений (RPN) на этапе трансляции
* Поддержка вложенных словарей и списков
* Читаемый и структурированный YAML IR
* Многострочные комментарии

